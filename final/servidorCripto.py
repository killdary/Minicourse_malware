import socket
import base64
from Crypto.Cipher import AES

chave = "0123456789ABCDEF"
aes = AES.new(chave, AES.MODE_ECB)

HOST = ''              									
PORT = 5000							

tcp = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
orig = (HOST, PORT)
tcp.bind(orig)											
tcp.listen(1)		
									
while True:
    con, cliente = tcp.accept()							
    print 'Concetado: ', cliente						
    while True:	
		mensagem = raw_input()		
		
		cryptoSaida = mensagem+'#'*(16-len(mensagem)%16)
		texto_cifrado = base64.b32encode(aes.encrypt(cryptoSaida))
				
		con.send(texto_cifrado)	
		
		print "Resposta do Cliente: "
		
		resposta_cifrada = con.recv(1024)
		
		dados = aes.decrypt(base64.b32decode(resposta_cifrada)).rstrip('#')
		
		
		print "passou"
		
		if not dados: break
		print dados
    print 'Finalizando conexao: ', cliente
    con.close()
